### 1. 项目定位
prolet-tools（主项目） ：

- 后端项目 ：负责文档管理和自动化部署
- 核心功能 ：文档下载、同步、转换、部署
- 部署目标 ：GitHub Pages
front-text（前端项目） ：

- 前端项目 ：负责用户界面和文档展示
- 核心功能 ：文档阅读、导航、交互
- 复用目标 ：可被多个项目引用
### 2. 解耦设计的核心目的 2.1 独立开发和维护
- 前后端分离 ：前端和后端可以独立迭代
- 互不影响 ：前端更新不影响文档下载逻辑
- 团队协作 ：不同团队可以并行开发 2.2 代码复用
- 多项目复用 ：前端代码可被多个文档项目引用
- 统一体验 ：保持一致的用户界面和交互
- 降低成本 ：避免重复开发相同功能 2.3 灵活部署
- 快速更新 ：仅更新前端代码，无需重新下载文档
- 独立测试 ：前端和后端可以独立测试
- 版本管理 ：前后端可以独立版本控制
### 3. 技术实现亮点 3.1 GitHub Actions 自动化集成
```
# 文档下载流程
sync-api.yml:
  - 下载文档文件
  - 生成文档索引
  - 上传 workspace artifact

# 前端部署流程
build-frontend.yml:
  - 下载 workspace artifact
  - 合并前端代码
  - 部署到 GitHub Pages
``` 3.2 Artifact 传递机制
- 数据传递 ：通过 GitHub Actions artifacts 传递下载的文件
- 避免重复下载 ：支持"仅重新部署"模式
- 自动触发 ：文档更新后自动触发部署 3.3 环境变量配置
```

```
### 4. 与 front-text 的协作关系 4.1 依赖关系
```
prolet-tools
    ↓ 依赖
front-text (前端代码)
    ↓ 提供
GitHub Pages (部署目标)

front-text (前端代码)
    ↓ 被引用
prolet-tools (主项目)
    ↓ 生成
GitHub Pages (最终网站)

```
## 1. 项目背景
### 项目名称
prolet-tools - 文档管理和自动化部署系统

### 项目定位
一个基于 GitHub Actions 的文档管理系统，实现从 GitHub API 下载文档、自动转换格式、生成索引并部署到 GitHub Pages 的完整流程。

### 当前架构
- 主仓库 ：coolapijust/prolet（后端逻辑、文档管理）
- 前端仓库 ：coolapijust/front-text（用户界面、文档展示）
- 部署目标 ：GitHub Pages
### 核心功能
1. 文档下载：通过 GitHub API 从指定仓库下载文档文件
2. 文档转换：将 TXT/MD/DOCX 文件转换为静态 HTML
3. 索引生成：自动生成文档索引和导航结构
4. 自动部署：部署到 GitHub Pages
## 2. 当前问题
### 2.1 前后端耦合问题
- 问题 ：前端代码和后端逻辑在同一个仓库中，难以独立维护
- 影响 ：前端更新需要修改主仓库，增加维护复杂度
- 现状 ：前端代码从 front-text 仓库 checkout，但 sync.py 也从 front-text 获取
### 2.2 文件传递效率问题
- 问题 ：每次部署都需要重新下载文档，浪费时间和资源
- 影响 ：部署速度慢，GitHub Actions 配额浪费
- 现状 ：虽然设计了 artifact 传递机制，但实现不完善
### 2.3 配置管理混乱
- 问题 ：sync.py 在不同环境中的路径计算不一致
- 影响 ：导致文档生成失败，部署失败
- 现状 ：SYNC_ROOT_DIR 环境变量配置不清晰
### 2.4 缓存机制不完善
- 问题 ：SHA 缓存只缓存文件哈希，不缓存文件内容
- 影响 ：文件仍需重新下载，缓存效果不明显
- 现状 ：缓存文件只有 125KB，不包含实际文档
## 3. 设计要求
### 3.1 核心原则
1. 前后端完全解耦 ：前端和后端独立维护，互不影响
2. 职责单一 ：每个组件只负责一个核心功能
3. 可复用性 ：前端代码可被多个文档项目引用
4. 自动化优先 ：尽可能减少手动操作
5. 性能优化 ：合理使用缓存，避免重复操作
### 3.2 技术约束
1. 代码行数限制 ：每个文件不超过 200 行，超过需模块化拆分
2. 调试信息 ：关键逻辑节点必须添加结构化调试信息（时间戳、模块标识、关键变量值）
3. 错误处理 ：所有异常点必须有明确的错误提示和恢复机制
4. 环境变量 ：使用环境变量配置路径，避免硬编码
### 3.3 GitHub Actions 约束
1. workflow 触发 ：支持自动触发和手动触发
2. artifact 管理 ：合理设置保留时间，避免过期
3. 并发控制 ：使用 concurrency 避免冲突
4. 权限管理 ：最小化权限，只授予必要的访问权限
## 4. 技术栈
### 4.1 后端技术栈
- 语言 ：Python 3.11+
- 核心库 ：
  - python-docx ：DOCX 文件处理
  - mammoth ：DOCX 转 HTML
  - pathlib ：路径处理
  - json ：配置和索引管理
- GitHub API ：REST API v3
- 缓存机制 ：GitHub Actions Cache
### 4.2 前端技术栈
- 语言 ：JavaScript (ES6+)
- 核心库 ：
  - 原生 JavaScript（无框架）
  - CSS3
  - HTML5
- 部署方式 ：GitHub Pages
### 4.3 CI/CD 工具
- GitHub Actions ：自动化工作流
- Artifact ：文件传递机制
- Pages ：静态网站托管
## 5. 期望输出
### 5.1 架构设计
请提供以下内容：

1. 整体架构图
   
   - 清晰展示前后端关系
   - 标注数据流向
   - 标注部署流程
2. 模块划分
   
   - 列出所有核心模块
   - 说明每个模块的职责
   - 说明模块间的依赖关系
3. 文件结构
   
   - 提供推荐的文件结构
   - 说明每个文件/目录的用途
### 5.2 实现方案
请提供以下内容：

1. 文档下载流程设计
   
   - 如何优化下载逻辑
   - 如何改进缓存机制
   - 如何处理错误和重试
2. 文档转换流程设计
   
   - 如何优化转换性能
   - 如何支持更多文件格式
   - 如何处理转换失败
3. 前端部署流程设计
   
   - 如何优化部署速度
   - 如何支持增量部署
   - 如何处理部署失败
### 5.3 代码实现
请提供以下内容：

1. 关键代码示例
   
   - sync.py 的核心逻辑
   - download-files.py 的优化方案
   - workflow 配置示例
2. 调试信息规范
   
   - 日志格式标准
   - 错误处理规范
   - 性能监控指标
3. 测试方案
   
   - 单元测试策略
   - 集成测试方案
   - 手动测试流程
### 5.4 部署配置
请提供以下内容：

1. GitHub Actions 配置
   
   - workflow 触发条件
   - artifact 配置策略
   - 环境变量设置
2. 环境变量清单
   
   - 所有需要的环境变量
   - 每个变量的用途
   - 默认值和可选值
3. 监控和告警
   
   - 如何监控 workflow 运行状态
   - 如何设置失败告警
   - 如何查看运行日志
## 6. 特殊要求
### 6.1 不做事项
1. 不要直接生成代码 ：先分析问题，然后提问并给出选项
2. 不要修改现有代码 ：除非明确要求
3. 不要创建文档文件 ：除非明确要求
4. 不要提交代码 ：除非明确要求

请按照以下格式组织输出：

### 第一部分：问题分析
- 当前问题总结
- 根本原因分析
- 影响评估
### 第二部分：设计方案
- 整体架构
- 模块划分
- 技术选型
### 第三部分：实现细节
- 核心代码
- 配置说明
- 部署流程
### 第四部分：优化建议
- 性能优化
- 可维护性提升
## 8. 使用说明

1. 仔细阅读项目背景和当前问题
2. 理解设计要求和技术约束
3. 按照期望输出的格式提供设计方案
4. 在每个部分中提供详细的分析和建议
5. 遵循"不直接生成代码"的原则，先分析再提问